"use strict";angular.module("gymApp",["ngAnimate","ngResource","ngCookies","ngRoute","ngSanitize","ngTouch","restangular"]).config(["$routeProvider","RestangularProvider","utilityProvider",function(a,b,c){c.set_router_white_list(["login","user/reset","gym/add","user/forgot"]),a.when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/gym/add",{templateUrl:"views/gymcreate.html",controller:"GymCreateCtrl"}).when("/gym/:id",{templateUrl:"views/gym.html",controller:"GymCtrl"}).when("/gym/:id/classes",{templateUrl:"views/classes.html",controller:"ClassesCtrl"}).when("/admin/:id/classes/add",{templateUrl:"views/classescreate.html",controller:"ClassesCreateCtrl"}).when("/user/reset/:id",{templateUrl:"views/reset.html",controller:"ResetCtrl"}).when("/admin/:id",{templateUrl:"views/admin.html",controller:"AdminCtrl"}).when("/admin/:id/user/add",{templateUrl:"views/usercreate.html",controller:"UsercreateCtrl"}).when("/user/forgot",{templateUrl:"views/forgot.html",controller:"ForgotCtrl"}).otherwise({redirectTo:"/login"}),b.setBaseUrl("https://gymapi-dev.herokuapp.com")}]),angular.module("gymApp").run(["$rootScope","utility","session","$location",function(a,b,c,d){var e=function(){return c.get_session_token()?!0:!1};b.set_validate_function(e),a.rg_router_is_wl=!1,a.$on("$routeChangeStart",function(e,f){console.log("prev",e),console.log("next",f),b.pass_validate(e,f).then(function(b){console.log("pass the validate",b),a.rg_router_is_wl=1==b.type},function(b){a.rg_router_is_wl=!0,console.log("reason",b)}),f.$$rotue&&f.$$route.regexp.test("/login")&&c.get_session_token()&&(e.preventDefault(),d.path("/"+(c.get_profile_id()>1?"gym":"admin")+"/2"))}),a.controller_name="",a.$on("$routeChangeSuccess",function(b,c){var d=c.controller||(c.$$route?c.$$route.controller:"NotCtrl");d=d.split(/(?=[A-Z])/).join("_").toLowerCase(),a.controller_name=d})}]),angular.module("gymApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("gymApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("gymApp").controller("LoginCtrl",["$scope","session","$location",function(a,b,c){a.user={email:"",password:"",remember:!0},a.submit_login=function(){b.login(a.user,a.user.remember).then(function(a){console.log("response",a),1==a.profile_id&&c.path("admin/"+a.gym_id)})}}]),angular.module("gymApp").service("session",["Restangular","$cookieStore","$q",function(a,b,c){function d(a){b.put(f.token_key,a)}function e(a){b.put(f.profile_key,a)}var f={token:null,profile_id:null,token_key:"session",profile_key:"profile"};this.store_session_token=function(a){f.token=a},this.store_profile_id=function(a){f.profile_id=a},this.get_session_token=function(){return f.token?f.token:b.get(f.token_key)?b.get(f.token_key):null},this.get_profile_id=function(){return f.profile_id?f.profile_id:b.get(f.profile_key)?b.get(f.profile_key):0},this.login=function(b,f){var g=c.defer(),h=this;return a.all("login").post(b).then(function(a){f&&(d(a.session_key||""),e(a.profile_id)),h.store_session_token(a.session_key||""),h.store_profile_id(a.profile_id),g.resolve(a)},function(a){g.reject(a)}),g.promise}}]),angular.module("gymApp").controller("GymCtrl",["$scope","$routeParams",function(a,b){a.classes={date:""},console.log("params",b)}]),angular.module("gymApp").directive("rgDatePicker",["$window","utility","$filter",function(a,b,c){return{restrict:"EA",scope:{date:"=rgDatePicker"},link:function(d,e,f){var g={format:"DD/MM/YYYY"},h=new Date,i=c("date")(h,"yyyy-MM-dd"),j=null;b.isMobile()?(e.attr("type","date"),e[0].valueAsDate=h,d.date=i,console.log("today",i),e.on("change",function(){d.date=e.val(),d.$apply()})):j=new a.UIkit.datepicker(e[0],g),d.date=new Date,console.log("picker",j)}}}]),angular.module("gymApp").provider("utility",[function(){function a(a){for(var b=!1,d=0;d<c.length;d++){var e=c[d];if(a.test(e)){b=!0;break}}return b}function b(){this.isMobile=function(){return"ontouchstart"in this.$window};var b=function(){return!0};this.set_validate_function=function(a){b=a},this.pass_validate=function(c,d){var e=this.$q.defer();return d.$$route&&!a(d.$$route.regexp)?(console.log("needs to validate",d),b()?e.resolve({type:1,description:"Route passes the auth function"}):e.reject({type:0,description:"Do not pass auth function"})):e.resolve({type:0,description:"Route is in the white list"}),e.promise}}var c=[],d="/";this.set_router_white_list=function(a){for(var b=0;b<a.length;b++){var d=a[b];"/"!==d[0]&&(d="/"+d),c.push(d)}},this.set_router_home_path=function(a){d=a},this.$get=["$window","$q",function(a,c){return b.prototype.$window=a,b.prototype.$q=c,new b}]}]),angular.module("gymApp").controller("ClassesCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("gymApp").controller("ClassesCreateCtrl",["$scope",function(a){a.classes={name:"",description:"",subscribers_limit:18,days:[{day:1,hours:[{coach:1,hour:8},{coach:1,hour:9}]},{day:2,hours:[{coach:1,hour:10},{coach:1,hour:11}]}]}}]),angular.module("gymApp").controller("GymCreateCtrl",["$scope","gym",function(a,b){a.gym={name:"",email:""},a.createGym=function(){b.create(a.gym).then(function(a){console.log("response",a)})}}]),angular.module("gymApp").service("gym",["Restangular",function(a){this.create=function(b){return a.all("gym").post(b)},this.get=function(b){return a.one("gym",b).get()},this.user_create=function(b,c){return a.one("gym",b).all("adduser").customPOST(c)}}]),angular.module("gymApp").controller("ResetCtrl",["$scope","$routeParams","user",function(a,b,c){a.user={email:"",password:"",id:b.id||0},a.reset=function(){c.reset_password(a.user).then(function(a){console.log("response",a)})}}]),angular.module("gymApp").service("user",["Restangular",function(a){this.reset_password=function(b){return a.one("reset",b.id).customPOST(b)},this.forgot=function(b){return a.all("forgot").customPOST(b)}}]),angular.module("gymApp").controller("AdminCtrl",["$scope","$routeParams","gym",function(a,b,c){a.gym={},c.get(b.id).then(function(b){a.gym=b,console.log("response",b)})}]),angular.module("gymApp").controller("UsercreateCtrl",["$scope","gym","$routeParams","$route",function(a,b,c,d){a.types=[{label:"STAFF",id:2},{label:"Coach",id:3},{label:"Atleta",id:4}],a.user={name:"",email:"",profile_id:4,phone_number:""},a.user_add=function(){console.log("log scopes",a.types),console.log("log scopes",a.user),b.user_create(c.id,a.user).then(function(a){console.log("user saved",a),d.reload()})}}]),angular.module("gymApp").controller("ForgotCtrl",["$scope","user",function(a,b){a.user={email:""},a.forgot=function(){console.log("user",a.user),b.forgot(a.user).then(function(a){console.log("response",a)})}}]);